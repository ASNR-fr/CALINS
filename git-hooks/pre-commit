#!/bin/bash

# Pre-commit git hook: Update version automatically before committing
# This script generates and updates the version number based on the current commit hash and date
# The version change will be included in the current commit

if [ -f "calins/src/version.py" ]; then
    # Read base version from version.py
    fullVersion=$(grep -oP '__version__\s*=\s*"\K[^"]+' calins/src/version.py)
    baseVersion=${fullVersion%%.dev*}
    
    # Get git hash and date
    hash=$(git rev-parse --short HEAD)
    date=$(date +%Y%m%d)
    
    # Build complete version
    version="${baseVersion}.dev0+${hash}.${date}"
    
    # Write to version.py
    cat > calins/src/version.py << EOF
"""Version file - automatically generated."""
__version__ = "$version"
EOF
    
    # Stage the version change (it will be included in this commit)
    git add calins/src/version.py
    echo "ðŸ“ Version updated: $version"
else
    echo "âŒ Error: calins/src/version.py not found"
    exit 1
fi

exit 0
